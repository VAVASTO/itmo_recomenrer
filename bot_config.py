#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Configuration file for ITMO Telegram Bot
"""

import os
from typing import Dict, Any

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ (–µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
try:
    from secrets import TELEGRAM_BOT_TOKEN, YANDEX_FOLDER_ID, YANDEX_AUTH_TOKEN
except ImportError:
    # –ï—Å–ª–∏ —Ñ–∞–π–ª secrets.py –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∏
    TELEGRAM_BOT_TOKEN = "YOUR_TELEGRAM_BOT_TOKEN"
    YANDEX_FOLDER_ID = "YOUR_YANDEX_FOLDER_ID"
    YANDEX_AUTH_TOKEN = "YOUR_YANDEX_AUTH_TOKEN"

# Telegram Bot Configuration
TELEGRAM_CONFIG = {
    'token': os.getenv('TELEGRAM_BOT_TOKEN', TELEGRAM_BOT_TOKEN),
    'webhook_url': os.getenv('WEBHOOK_URL', ''),
    'use_webhook': os.getenv('USE_WEBHOOK', 'false').lower() == 'true',
    'max_message_length': 4000,
    'timeout': 30
}

# YandexGPT Configuration
YANDEX_CONFIG = {
    'folder_id': os.getenv('YANDEX_FOLDER_ID', YANDEX_FOLDER_ID),
    'auth_token': os.getenv('YANDEX_AUTH_TOKEN', YANDEX_AUTH_TOKEN),
    'model_name': 'yandexgpt',
    'temperature': 0.3,
    'max_tokens': 2000
}

# Bot Behavior Configuration
BOT_CONFIG = {
    'response_timeout': 30,
    'max_retries': 3,
    'retry_delay': 2,
    'log_level': 'INFO',
    'log_file': 'telegram_bot.log',
    'conversation_cache_size': 1000,
    'conversation_timeout': 3600  # 1 hour
}

# System Prompts
SYSTEM_PROMPTS = {
    'main': """–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —É—á–µ–±–Ω—ã–º –ø–ª–∞–Ω–∞–º –ò–¢–ú–û –¥–ª—è –º–∞–≥–∏—Å—Ç–µ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" –∏ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏".

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
1. –û—Ç–≤–µ—á–∞–π –°–¢–†–û–ì–û –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º —É—á–µ–±–Ω—ã–º –ø–ª–∞–Ω–∞–º
2. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç –≤ —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–∞—Ö - —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º
3. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ –ø–ª–∞–Ω–∞—Ö
4. –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—á–µ—Ç–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏ —á–∞—Å–æ–≤
5. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É - –Ω–∞–π–¥–∏ –µ—ë –≤ –ø–ª–∞–Ω–∞—Ö –∏ –¥–∞–π —Ç–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
6. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
7. –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º
8. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ò–¢–ú–û, –≤–µ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å –∫ —Ç–µ–º–µ —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –î–õ–Ø TELEGRAM:
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π <b>–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b> (–ù–ï **—Ç–µ–∫—Å—Ç**) –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–æ–≥—Ä–∞–º–º –∏ –≤–∞–∂–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π <i>–∫—É—Ä—Å–∏–≤</i> (–ù–ï *—Ç–µ–∫—Å—Ç*) –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π <code>–∫–æ–¥</code> –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ü–∏—Ñ—Ä (–∑–∞—á–µ—Ç–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã, —á–∞—Å—ã)
- –ò—Å–ø–æ–ª—å–∑—É–π ‚Ä¢ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω
- –ò—Å–ø–æ–ª—å–∑—É–π üìö üìä üéì –∏ –¥—Ä—É–≥–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç —Å –∞–±–∑–∞—Ü–∞–º–∏ –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫
- –î–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≥—Ä—É–ø–ø–∏—Ä—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Å–µ–º–µ—Å—Ç—Ä–∞–º –∏–ª–∏ –±–ª–æ–∫–∞–º

–ó–ê–ü–†–ï–©–ï–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **–∂–∏—Ä–Ω—ã–π** (–¥–≤–æ–π–Ω—ã–µ –∑–≤–µ–∑–¥–æ—á–∫–∏) - –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –≤ Telegram
- *–∫—É—Ä—Å–∏–≤* (–æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∑–≤–µ–∑–¥–æ—á–∫–∏) - –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –≤ Telegram
- ```–∫–æ–¥``` (—Ç—Ä–æ–π–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏) - –∏—Å–ø–æ–ª—å–∑—É–π <code>–∫–æ–¥</code>

–£–ß–ï–ë–ù–´–ï –ü–õ–ê–ù–´:

{curriculum_text}

–û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è Telegram.""",
    
    'welcome': """üéì –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç –ø–æ —É—á–µ–±–Ω—ã–º –ø–ª–∞–Ω–∞–º –ò–¢–ú–û!

–Ø –ø–æ–º–æ–≥—É –≤–∞–º –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–≥–∏—Å—Ç–µ—Ä—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö:
‚Ä¢ <b>–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç</b>
‚Ä¢ <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</b>

–í—ã –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å:
‚Ä¢ –ö–∞–∫–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –µ—Å—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ?
‚Ä¢ –°–∫–æ–ª—å–∫–æ –∑–∞—á–µ—Ç–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü —É –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã?
‚Ä¢ –í –∫–∞–∫–æ–º —Å–µ–º–µ—Å—Ç—Ä–µ –∏–∑—É—á–∞–µ—Ç—Å—è –ø—Ä–µ–¥–º–µ—Ç?
‚Ä¢ –ö–∞–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã?
‚Ä¢ –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!

–ü—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å! üí¨""",
    
    'help': """üìö <b>–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É</b>

<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:</b>
‚Ä¢ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏/AI Product

<b>–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:</b>
‚Ä¢ "–ö–∞–∫–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –ø–æ –º–∞—à–∏–Ω–Ω–æ–º—É –æ–±—É—á–µ–Ω–∏—é –µ—Å—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ò–ò?"
‚Ä¢ "–°–∫–æ–ª—å–∫–æ –∑–∞—á–µ—Ç–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü —É –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã '–ì–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ'?"
‚Ä¢ "–ö–∞–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ 3 —Å–µ–º–µ—Å—Ç—Ä–µ?"
‚Ä¢ "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º—É –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏"

<b>–ö–æ–º–∞–Ω–¥—ã:</b>
/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ! üá∑üá∫""",
    
    'error': "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
    'no_response': "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
}

# Validation functions
def validate_config() -> Dict[str, Any]:
    """Validate configuration and return status"""
    issues = []
    
    # Check Telegram token
    if not TELEGRAM_CONFIG['token'] or TELEGRAM_CONFIG['token'] == 'YOUR_TELEGRAM_TOKEN':
        issues.append("Telegram bot token not configured")
    
    # Check YandexGPT credentials
    if not YANDEX_CONFIG['folder_id'] or YANDEX_CONFIG['folder_id'] == 'YOUR_FOLDER_ID':
        issues.append("YandexGPT folder_id not configured")
    
    if not YANDEX_CONFIG['auth_token'] or YANDEX_CONFIG['auth_token'] == 'YOUR_AUTH_TOKEN':
        issues.append("YandexGPT auth_token not configured")
    
    return {
        'valid': len(issues) == 0,
        'issues': issues
    }

def get_config_summary() -> str:
    """Get configuration summary for logging"""
    return f"""
Bot Configuration:
- Telegram Token: {'‚úì Set' if TELEGRAM_CONFIG['token'] else '‚úó Missing'}
- YandexGPT Folder ID: {'‚úì Set' if YANDEX_CONFIG['folder_id'] else '‚úó Missing'}
- YandexGPT Auth Token: {'‚úì Set' if YANDEX_CONFIG['auth_token'] else '‚úó Missing'}
- Log Level: {BOT_CONFIG['log_level']}
- Max Message Length: {TELEGRAM_CONFIG['max_message_length']}
- Model Temperature: {YANDEX_CONFIG['temperature']}
"""